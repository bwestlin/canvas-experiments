<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Plasma canvas</title>

  <script src="lib/jquery-2.1.3.min.js"></script>
  <script src="lib/lodash-3.0.1.min.js"></script>
  <script src="js/canvas-helpers.js"></script>

  <script type="text/javascript">


    function dist(x, y, w, h) {
      return Math.sqrt((x - w / 2) * (x - w / 2) + (y - h / 2) * (y - h / 2));
    }

    function sin(v) {
      return Math.sin(v);
    }

    function cos(v) {
      return Math.cos(v);
    }

    function renderPlasma(lastFrameMillisec) {

      var canvas = document.getElementById("plasma-canvas");
      var ctx = canvas.getContext("2d");
      ctx.save();
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height); //ctx.createImageData(canvas.width, canvas.height);
      //console.log("imageData:", imageData);

      var currMillisec = new Date().getTime();
      var time = currMillisec / 2000.0;


      for (var y = 0; y < canvas.height; y++) {
        for (var x = 0; x < canvas.width; x++) {

          var value =
              sin(dist(x + time, y, 128.0 * sin(time), 128.0 * sin(time)) / 8.0) +
              sin(dist(x, y, 64.0 * cos(time), 64.0 * cos(time)) / 16.0) +
              sin(dist(x, y + time / 7, 192.0, 64) / 17.0) +
              sin(dist(x, y, 192.0, 100.0) / 8.0);

          var color = parseInt(4 + value) * 32;

          var dataPos = (y * canvas.width * 4) + (x * 4);

          imageData.data[dataPos + 0] = color;
          imageData.data[dataPos + 1] = color * 2;
          imageData.data[dataPos + 2] = 255 - color;
          imageData.data[dataPos + 3] = 255;
        }
      }

      ctx.putImageData(imageData, 0, 0);

      // Draw fps
      var fps = 1000 / lastFrameMillisec;
      if (fps) {
        ctx.font = "bold 20px 'Helvetica Neue', Helvetica, Arial, sans-serif";
        var fpsText = "Fps: " + fps.toFixed(1);
        ctx.fillStyle = '#FFFFFF';
        ctx.strokeStyle = '#444444';
        ctx.fillText(fpsText, 10, 22);
        ctx.strokeText(fpsText, 10, 22);
      }

      ctx.restore();
    }

    $(window).load(function() {
      AnimationHelper.registerAnimCallback(renderPlasma);
      AnimationHelper.startAnim();
    });
  </script>

</head>
<body>

  <canvas id="plasma-canvas" width="400" height="400" style="border: 1px solid gray;"></canvas>

</body>
</html>